---
/**
 * MenuItem - Individual menu item display
 */
import DietaryBadges from "./DietaryBadges.astro";
import AllergenInfo from "./AllergenInfo.astro";
import AddToCartButton from "./cart/AddToCartButton.astro";
import type { MenuItem } from "@/lib/menu";
import { config } from "@/config";

interface Props {
  item: MenuItem;
}

const { item } = Astro.props;
const showAddToCart = config.restaurant.features.onlineOrdering;

const priceDisplay = typeof item.price === "number"
  ? `$${item.price.toFixed(2)}`
  : `$${item.price}`;
---

<div
  class="menu-item p-4 rounded-lg bg-base-100 shadow-sm hover:shadow-md transition-shadow"
  class:list={{ unavailable: !item.is_available }}
  data-item-id={item.id}
>
  <div class="flex gap-4">
    {item.image_url && (
      <div class="flex-shrink-0">
        <img
          src={item.image_url}
          alt={item.name}
          class="w-24 h-24 object-cover rounded-lg"
          loading="lazy"
        />
      </div>
    )}

    <div class="flex-grow min-w-0">
      <div class="flex justify-between items-start gap-2">
        <div class="flex items-center gap-2 flex-wrap">
          <h3 class="font-semibold text-lg">{item.name}</h3>
          <DietaryBadges
            isVegetarian={item.is_vegetarian}
            isVegan={item.is_vegan}
            isGlutenFree={item.is_gluten_free}
          />
        </div>
        <span class="menu-price text-lg flex-shrink-0">{priceDisplay}</span>
      </div>

      {item.description && (
        <p class="text-base-content/70 text-sm mt-1">{item.description}</p>
      )}

      <div class="mt-2 flex flex-wrap items-center gap-2">
        {!item.is_available && (
          <span class="badge badge-error badge-sm">Currently unavailable</span>
        )}
        <AllergenInfo allergens={item.allergens || []} />
      </div>

      {item.modifier_groups && item.modifier_groups.length > 0 && (
        <div class="mt-2 text-xs text-base-content/60">
          {item.modifier_groups.map((group) => (
            <span class="mr-2">
              {group.min_selections > 0 ? "Choose" : "Add"}: {group.name}
            </span>
          ))}
        </div>
      )}

      {showAddToCart && (
        <div class="mt-3">
          <AddToCartButton item={item} />
        </div>
      )}
    </div>
  </div>
</div>
